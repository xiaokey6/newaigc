# 旅游规划系统前端与后端对接指南

本文档提供了前端与Python+Flask后端对接的配置说明、测试步骤和常见问题排查指南。

## 配置概述

我们已经完成了以下配置修改，实现前端与后端的无缝对接：

1. **开发环境跨域代理配置** - 通过Vite的代理设置，解决浏览器跨域限制
2. **统一API请求工具封装** - 创建了src/utils/api.js，简化接口调用
3. **接口数据格式适配** - 修改了InputPage和PlanPage，确保与后端数据格式匹配
4. **环境变量配置** - 添加了开发和生产环境的API地址配置
5. **接口调试辅助功能** - 添加了请求/响应日志和错误提示

## 验证连接的测试步骤

### 1. 准备工作

确保以下条件满足：

- Node.js环境已安装（建议v16+）
- Python环境已安装（后端运行环境）
- 后端服务已开发完成并可在http://localhost:5000访问

### 2. 启动前端项目

```bash
# 1. 安装依赖
npm install

# 2. 启动开发服务器
npm run dev
```

### 3. 启动后端服务

```bash
# 在后端项目目录中执行
python app.py
```

确保后端服务成功启动并监听在http://localhost:5000。

### 4. 验证功能

1. **访问需求输入页面**
   - 打开浏览器，访问前端开发服务器地址（通常是http://localhost:5173）
   - 填写旅游需求表单，包括场景、天数、预算、兴趣标签等
   - 点击「生成方案」按钮提交

2. **检查方案展示页面**
   - 页面应自动跳转到方案展示页
   - 检查是否显示从后端获取的行程数据
   - 验证预算计算是否正确

3. **测试动态调整功能**
   - 点击「预算太高」、「景点太少」等调整按钮
   - 验证是否重新从后端获取调整后的方案

### 5. 检查网络请求

使用浏览器开发者工具的「网络」选项卡，确认：

- 请求路径为`/api/plan/input`和`/api/plan/adjust`
- 请求方法为POST
- 请求体包含正确格式化的参数
- 响应状态为200
- 响应体包含预期的行程数据

## 常见问题排查

### 1. 跨域问题

**问题**: 控制台报错"Access to XMLHttpRequest at...has been blocked by CORS policy"

**解决方法**:
- 确认Vite配置中的代理设置正确
- 重启前端开发服务器
- 检查后端是否设置了CORS允许前端域名访问

### 2. 代理配置问题

**问题**: 请求未被正确代理到后端

**解决方法**:
- 检查vite.config.js中的proxy配置是否正确
- 确认API请求路径以`/api`开头
- 重启前端开发服务器

### 3. 后端未启动

**问题**: 控制台报错"Network Error"或"ECONNREFUSED"

**解决方法**:
- 确认后端服务已启动
- 验证后端服务监听端口是否为5000
- 尝试在浏览器中直接访问http://localhost:5000，检查后端是否正常响应

### 4. 参数格式错误

**问题**: 后端返回错误，提示参数格式不正确

**解决方法**:
- 检查控制台中打印的请求参数
- 确认days和budget为数字类型
- 确认interests为数组类型
- 检查所有必填字段是否都已填写

### 5. 数据类型错误

**问题**: 前端报错"map is not a function"或其他类型错误

**解决方法**:
- 检查后端返回的数据结构是否符合预期
- 确保返回的行程数据是数组格式
- 查看控制台日志，确认具体的错误位置

### 6. 环境变量问题

**问题**: API请求路径不正确

**解决方法**:
- 检查.env.development和.env.production文件是否存在
- 确认环境变量命名正确（VITE_API_BASE_URL）
- 重启前端开发服务器使环境变量生效

## 部署注意事项

1. **生产环境部署**:
   - 修改.env.production中的API地址为实际后端域名
   - 执行`npm run build`生成生产构建
   - 确保生产环境中的后端已配置CORS允许前端域名访问

2. **接口监控**:
   - 生产环境建议添加更完善的错误监控
   - 考虑添加请求超时和重试机制

3. **性能优化**:
   - 对于大量行程数据，考虑实现虚拟滚动
   - 可以添加数据缓存机制，减少重复请求